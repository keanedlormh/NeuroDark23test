<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NeuroDark23 | FX Core (Offline)</title>
    <link rel="stylesheet" href="style.css">
    
    <script>
        window.logToScreen = function(msg, type='info') {
            const consoleEl = document.getElementById('sys-log-content');
            if(consoleEl) {
                const line = document.createElement('div');
                line.className = type === 'error' ? 'log-err' : (type === 'warn' ? 'log-warn' : 'log-info');
                const time = new Date().toLocaleTimeString().split(' ')[0];
                line.innerText = `[${time}] ${msg}`;
                consoleEl.appendChild(line);
                consoleEl.scrollTop = consoleEl.scrollHeight;
            }
            console.log(`[ND23] ${msg}`);
        };

        // Captura de errores globales
        window.onerror = function(msg, url, line) {
            window.logToScreen(`CRITICAL: ${msg} (L${line})`, 'error');
            const p = document.getElementById('sys-log-panel');
            if(p) { 
                // La lógica de clases del JS se mantendrá, definiremos las transiciones en CSS
                p.classList.remove('log-hidden'); 
                p.classList.add('log-visible');
            }
            return false;
        };

        window.addEventListener('unhandledrejection', function(event) {
            window.logToScreen(`ASYNC ERR: ${event.reason}`, 'error');
        });
    </script>
</head>
<body class="app-body">

    <div id="sys-log-panel" class="log-panel log-hidden">
        <div class="log-header">
            <span class="log-title">:: SYSTEM_DEBUG ::</span>
            <div class="log-controls">
                <button onclick="document.getElementById('sys-log-content').innerHTML=''" class="btn-log-clear">CLEAR</button>
                <button id="btn-toggle-log-internal" class="btn-log-toggle">[ HIDE ]</button>
            </div>
        </div>
        <div id="sys-log-content" class="log-content">
            <div class="log-placeholder">System Ready. Waiting for Audio Context...</div>
        </div>
    </div>

    <div id="export-modal" class="modal-overlay hidden">
        <div class="modal-box border-green">
            <h2 class="modal-title title-green">RENDER WAV</h2>
            <div class="modal-section">
                <label class="modal-label label-green">LOOPS:</label>
                <div class="grid-loops">
                    <button class="export-rep-btn active" data-rep="1">1x</button>
                    <button class="export-rep-btn" data-rep="2">2x</button>
                    <button class="export-rep-btn" data-rep="4">4x</button>
                    <button class="export-rep-btn" data-rep="8">8x</button>
                </div>
            </div>
            <button id="btn-start-render" class="btn-main btn-green">RENDER</button>
            <button id="btn-close-export" class="btn-cancel">CANCEL</button>
        </div>
    </div>

    <div id="memory-modal" class="modal-overlay hidden">
        <div class="modal-box border-purple modal-wide">
            <h2 class="modal-title title-purple">VIRTUAL MEMORY (.CSV)</h2>
            
            <div class="modal-section">
                <label class="modal-label label-purple">CSV DATA STREAM:</label>
                <textarea id="csv-io-area" class="csv-textarea"></textarea>
            </div>

            <div class="grid-actions">
                <button id="btn-gen-csv" class="btn-action btn-purple">GENERATE CSV</button>
                <button id="btn-load-csv" class="btn-action btn-green">LOAD FROM TEXT</button>
            </div>

            <div class="file-actions">
                <button id="btn-download-csv" class="btn-link">Download File</button>
                <span class="separator">|</span>
                <label class="btn-link cursor-pointer">
                    Upload File
                    <input type="file" id="file-upload-csv" accept=".csv" class="hidden">
                </label>
            </div>

            <button id="btn-close-memory" class="btn-close">CLOSE MEMORY</button>
        </div>
    </div>

    <div id="main-menu" class="modal-overlay hidden">
        <div class="menu-box">
            <h2 class="menu-title glitch-text">MENU</h2>
            
            <div class="menu-group">
                 <button id="btn-toggle-ui-mode" class="btn-menu btn-toggle-ui">UI MODE: ANALOG</button>
                 <button id="btn-toggle-visualizer" class="btn-menu btn-toggle-vis">VISUALIZER: OFF</button>
            </div>

            <div class="menu-group">
                <h3 class="menu-subtitle">Modules</h3>
                <div id="synth-list-container" class="synth-list"></div>
                <button id="btn-add-synth" class="btn-add-synth">+ ADD BASS</button>
            </div>
            <div class="menu-group vertical">
                <button id="btn-open-memory" class="btn-menu btn-purple">VIRTUAL MEMORY (.CSV)</button>
                <button id="btn-open-export" class="btn-menu btn-green">EXPORT WAV</button>
                <button id="btn-toggle-log-menu" class="btn-menu">SHOW LOGS</button>
                <button id="btn-menu-clear" class="btn-menu btn-red-dim">CLEAR PATTERN</button>
                <button id="btn-menu-panic" class="btn-menu btn-red">RESET</button>
            </div>
            <button id="btn-menu-close" class="btn-resume">RESUME</button>
        </div>
    </div>

    <header id="app-header" class="app-header">
        <div class="logo-group group" id="app-logo">
            <div id="activity-led" class="led-indicator"></div>
            <span class="app-title glitch-text">NEURODARK23</span>
        </div>
        <button id="btn-open-menu" class="btn-hamburger">&#9776;</button>
    </header>

    <div id="workspace" class="workspace custom-scroll">
        <div class="workspace-inner">
            
            <div class="dashboard-panel">
                <div class="dashboard-bg"></div>
                <div class="dash-control">
                    <label class="dash-label">BPM</label>
                    <input type="number" id="bpm-input" value="174" class="bpm-input">
                </div>
                <div id="play-container" class="play-container">
                    <svg id="play-clock-svg" class="clock-svg" viewBox="0 0 100 100"></svg>
                    <button id="btn-play" class="btn-play">&#9658;</button>
                </div>
                <div class="dash-control">
                    <label class="dash-label">BLOCK</label>
                    <div class="block-display">
                        <span id="display-current-block">1</span> / <span id="display-total-blocks">1</span>
                    </div>
                </div>
            </div>

            <div class="track-section">
                <div class="track-header">
                    <span class="track-label">CHAIN</span>
                    <div class="track-tools">
                        <button id="btn-mem-copy" class="track-ctrl-btn btn-cyan" title="Copy Pattern">CPY</button>
                        <button id="btn-mem-paste" class="track-ctrl-btn btn-cyan" title="Paste Pattern">PST</button>
                        <div class="spacer"></div>
                        <button id="btn-move-left" class="track-ctrl-btn" title="Move Left">&larr;</button>
                        <button id="btn-move-right" class="track-ctrl-btn" title="Move Right">&rarr;</button>
                        <div class="spacer"></div>
                        <button id="btn-add-block" class="track-ctrl-btn btn-green-sm">+</button>
                        <button id="btn-del-block" class="track-ctrl-btn btn-red-sm">&times;</button>
                    </div>
                </div>
                <div id="track-bar" class="track-bar custom-scroll"></div>
            </div>

            <div id="instrument-tabs-container" class="tabs-container"></div>

            <div id="matrix-container" class="matrix-grid"></div>
            <div class="bottom-spacer"></div> 
        </div>
    </div>

    <div id="editor-panel" class="editor-panel panel-expanded">
        
        <div id="panel-header-trigger" class="panel-header">
            <span id="step-info-display" class="edit-info">EDIT</span>
            
            <div class="panel-controls">
                <button id="btn-toggle-view-keys" class="btn-toggle-view">KEYS</button>
                <button id="btn-toggle-view-fx" class="btn-toggle-view">FX</button>
                
                <div class="separator-v"></div>
                
                <button id="btn-minimize-panel" class="btn-minimize">
                    &#9660; 
                </button>
            </div>
        </div>

        <div class="panel-content">
            <div id="editor-bass" class="editor-bass custom-scroll">
                
                <div id="subpanel-fx" class="subpanel">
                     <div id="fx-container-bar" class="fx-container">
                        
                        <div id="fx-controls-analog" class="fx-analog-grid">
                            <div class="fx-item col-span-2">
                                <label class="fx-label label-green">VOL</label>
                                <input type="range" id="vol-slider" min="0" max="100" value="85" class="fx-slider">
                            </div>

                            <div class="fx-item">
                                <label class="fx-label">CUT</label>
                                <input type="range" id="cutoff-slider" min="100" max="5000" value="800" class="fx-slider">
                            </div>
                            <div class="fx-item">
                                <label class="fx-label">RES</label>
                                <input type="range" id="res-slider" min="0" max="20" value="4" class="fx-slider">
                            </div>
                            <div class="fx-item">
                                <label class="fx-label">ENV</label>
                                <input type="range" id="env-slider" min="0" max="100" value="60" class="fx-slider">
                            </div>
                            <div class="fx-item">
                                <label class="fx-label">DEC</label>
                                <input type="range" id="dec-slider" min="0" max="100" value="40" class="fx-slider">
                            </div>
                            <div class="fx-item">
                                <label class="fx-label">ACC</label>
                                <input type="range" id="acc-slider" min="0" max="100" value="50" class="fx-slider">
                            </div>
                            <div class="fx-item">
                                <label class="fx-label">DRV</label>
                                <input type="range" id="dist-slider" min="0" max="100" value="20" class="fx-slider">
                            </div>
                            <div class="fx-item">
                                <label class="fx-label">TONE</label>
                                <input type="range" id="tone-slider" min="0" max="100" value="100" class="fx-slider">
                            </div>
                            <div class="fx-item">
                                <label class="fx-label">GAIN</label>
                                <input type="range" id="dgain-slider" min="0" max="100" value="60" class="fx-slider">
                            </div>
                        </div>

                        <div id="fx-controls-digital" class="fx-digital-flex hidden">
                            <div class="digital-fx-box">
                                <div class="dfx-label text-green">VOL</div>
                                <div class="dfx-value-container">
                                    <input type="number" id="vol-digital" value="85" class="dfx-value" min="0" max="100">
                                </div>
                                <div class="dfx-buttons">
                                    <button class="dfx-btn" data-target="volume" data-dir="-1">-</button>
                                    <button class="dfx-btn" data-target="volume" data-dir="1">+</button>
                                </div>
                            </div>

                            <div class="digital-fx-box">
                                <div class="dfx-label">CUT</div>
                                <div class="dfx-value-container">
                                    <input type="number" id="cutoff-digital" value="14" class="dfx-value" min="0" max="100">
                                </div>
                                <div class="dfx-buttons">
                                    <button class="dfx-btn" data-target="cutoff" data-dir="-1">-</button>
                                    <button class="dfx-btn" data-target="cutoff" data-dir="1">+</button>
                                </div>
                            </div>

                            <div class="digital-fx-box">
                                <div class="dfx-label">RES</div>
                                <div class="dfx-value-container">
                                    <input type="number" id="res-digital" value="20" class="dfx-value" min="0" max="100">
                                </div>
                                <div class="dfx-buttons">
                                    <button class="dfx-btn" data-target="resonance" data-dir="-1">-</button>
                                    <button class="dfx-btn" data-target="resonance" data-dir="1">+</button>
                                </div>
                            </div>

                            <div class="digital-fx-box">
                                <div class="dfx-label">ENV</div>
                                <div class="dfx-value-container">
                                    <input type="number" id="env-digital" value="60" class="dfx-value" min="0" max="100">
                                </div>
                                <div class="dfx-buttons">
                                    <button class="dfx-btn" data-target="envMod" data-dir="-1">-</button>
                                    <button class="dfx-btn" data-target="envMod" data-dir="1">+</button>
                                </div>
                            </div>

                            <div class="digital-fx-box">
                                <div class="dfx-label">DEC</div>
                                <div class="dfx-value-container">
                                    <input type="number" id="dec-digital" value="40" class="dfx-value" min="0" max="100">
                                </div>
                                <div class="dfx-buttons">
                                    <button class="dfx-btn" data-target="decay" data-dir="-1">-</button>
                                    <button class="dfx-btn" data-target="decay" data-dir="1">+</button>
                                </div>
                            </div>

                            <div class="digital-fx-box">
                                <div class="dfx-label">ACC</div>
                                <div class="dfx-value-container">
                                    <input type="number" id="acc-digital" value="50" class="dfx-value" min="0" max="100">
                                </div>
                                <div class="dfx-buttons">
                                    <button class="dfx-btn" data-target="accentInt" data-dir="-1">-</button>
                                    <button class="dfx-btn" data-target="accentInt" data-dir="1">+</button>
                                </div>
                            </div>

                            <div class="digital-fx-box">
                                <div class="dfx-label">DRV</div>
                                <div class="dfx-value-container">
                                    <input type="number" id="dist-digital" value="20" class="dfx-value" min="0" max="100">
                                </div>
                                <div class="dfx-buttons">
                                    <button class="dfx-btn" data-target="distortion" data-dir="-1">-</button>
                                    <button class="dfx-btn" data-target="distortion" data-dir="1">+</button>
                                </div>
                            </div>

                            <div class="digital-fx-box">
                                <div class="dfx-label">TONE</div>
                                <div class="dfx-value-container">
                                    <input type="number" id="tone-digital" value="100" class="dfx-value" min="0" max="100">
                                </div>
                                <div class="dfx-buttons">
                                    <button class="dfx-btn" data-target="distTone" data-dir="-1">-</button>
                                    <button class="dfx-btn" data-target="distTone" data-dir="1">+</button>
                                </div>
                            </div>

                             <div class="digital-fx-box">
                                <div class="dfx-label">GAIN</div>
                                <div class="dfx-value-container">
                                    <input type="number" id="dgain-digital" value="60" class="dfx-value" min="0" max="100">
                                </div>
                                <div class="dfx-buttons">
                                    <button class="dfx-btn" data-target="distGain" data-dir="-1">-</button>
                                    <button class="dfx-btn" data-target="distGain" data-dir="1">+</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="subpanel-keys" class="subpanel keys-container">
                    <div class="keys-controls">
                        <div class="octave-ctrl">
                            <button id="oct-down" class="btn-oct">-</button>
                            <span id="oct-display" class="oct-display">3</span>
                            <button id="oct-up" class="btn-oct">+</button>
                        </div>
                        
                        <div class="modifiers-ctrl">
                            <button id="btn-toggle-slide" class="btn-mod">~ SLIDE</button>
                            <button id="btn-toggle-accent" class="btn-mod">^ ACCENT</button>
                        </div>

                        <button id="btn-waveform" class="btn-wave">
                            <span class="wave-icon">~</span>
                            <span>SAW</span>
                        </button>
                    </div>

                    <div id="piano-container" class="piano-wrapper">
                        <div class="piano-white-keys">
                            <button class="piano-key white-key" data-note="C">C</button>
                            <button class="piano-key white-key" data-note="D">D</button>
                            <button class="piano-key white-key" data-note="E">E</button>
                            <button class="piano-key white-key" data-note="F">F</button>
                            <button class="piano-key white-key" data-note="G">G</button>
                            <button class="piano-key white-key" data-note="A">A</button>
                            <button class="piano-key white-key" data-note="B">B</button>
                        </div>

                        <button class="piano-key black-key pos-1" data-note="C#">C#</button>
                        <button class="piano-key black-key pos-2" data-note="D#">D#</button>
                        <button class="piano-key black-key pos-3" data-note="F#">F#</button>
                        <button class="piano-key black-key pos-4" data-note="G#">G#</button>
                        <button class="piano-key black-key pos-5" data-note="A#">A#</button>
                    </div>
                    
                    <button id="btn-delete-note" class="btn-clear-note">CLEAR NOTE</button>
                </div>
            </div>

            <div id="editor-drum" class="editor-drum hidden custom-scroll"></div>
        </div>
    </div>

    <script src="Synth/fx_synth.js"></script>
    <script src="Synth/bass_synth.js"></script>
    <script src="Synth/drum_synth.js"></script>
    <script src="Synth/timematrix.js"></script>
    <script src="Synth/audio_engine.js"></script>
    <script src="Synth/ui_controller.js"></script>
    <script src="main.js"></script>
</body>
</html>