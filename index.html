<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NeuroDark23 | v38 UI Update</title>
    <link rel="stylesheet" href="style.css">
    
    <script>
        window.logToScreen = function(msg, type='info') {
            const consoleEl = document.getElementById('sys-log-content');
            if(consoleEl) {
                const line = document.createElement('div');
                line.className = type === 'error' ? 'log-err' : (type === 'warn' ? 'log-warn' : 'log-info');
                const time = new Date().toLocaleTimeString().split(' ')[0];
                line.innerText = `[${time}] ${msg}`;
                consoleEl.appendChild(line);
                consoleEl.scrollTop = consoleEl.scrollHeight;
            }
            console.log(`[ND23] ${msg}`);
        };

        window.onerror = function(msg, url, line) {
            window.logToScreen(`CRITICAL: ${msg} (L${line})`, 'error');
            const p = document.getElementById('sys-log-panel');
            if(p) p.classList.add('visible');
            return false;
        };
    </script>
</head>
<body>

    <!-- LOG TERMINAL -->
    <div id="sys-log-panel" class="log-terminal">
        <div class="terminal-header">
            <span class="terminal-title">:: SYSTEM_DEBUG ::</span>
            <div class="terminal-controls">
                <button onclick="document.getElementById('sys-log-content').innerHTML=''" class="btn-term">CLEAR</button>
                <button id="btn-toggle-log-internal" class="btn-term">[ HIDE ]</button>
            </div>
        </div>
        <div id="sys-log-content" class="terminal-body custom-scroll">
            <div class="log-init">System Ready. Initializing Audio Engine v38...</div>
        </div>
    </div>

    <!-- EXPORT MODAL -->
    <div id="export-modal" class="modal-overlay hidden">
        <div class="modal-window border-green">
            <h2 class="modal-header text-green">RENDER AUDIO</h2>
            <div class="modal-content">
                <label class="label-tech text-green">LOOP COUNT:</label>
                <div class="grid-4">
                    <button class="btn-option active" data-rep="1">1x</button>
                    <button class="btn-option" data-rep="2">2x</button>
                    <button class="btn-option" data-rep="4">4x</button>
                    <button class="btn-option" data-rep="8">8x</button>
                </div>
            </div>
            <div class="modal-footer">
                <button id="btn-start-render" class="btn-primary btn-green-solid">RENDER WAV</button>
                <button id="btn-close-export" class="btn-text">CANCEL</button>
            </div>
        </div>
    </div>

    <!-- MEMORY MODAL -->
    <div id="memory-modal" class="modal-overlay hidden">
        <div class="modal-window border-purple modal-wide">
            <h2 class="modal-header text-purple">VIRTUAL MEMORY</h2>
            
            <div class="modal-content">
                <label class="label-tech text-purple">DATA STREAM:</label>
                <textarea id="csv-io-area" class="input-area custom-scroll" spellcheck="false"></textarea>
            </div>

            <div class="grid-2 gap-md">
                <button id="btn-gen-csv" class="btn-secondary text-purple border-purple">GENERATE CSV</button>
                <button id="btn-load-csv" class="btn-secondary text-green border-green">LOAD FROM TEXT</button>
            </div>

            <div class="file-io-bar">
                <button id="btn-download-csv" class="link-btn">DOWNLOAD FILE</button>
                <span class="sep">|</span>
                <label class="link-btn">
                    UPLOAD FILE
                    <input type="file" id="file-upload-csv" accept=".csv" hidden>
                </label>
            </div>

            <button id="btn-close-memory" class="btn-block-dark">CLOSE MEMORY</button>
        </div>
    </div>

    <!-- MAIN CONFIG MENU -->
    <div id="main-menu" class="modal-overlay hidden">
        <div class="menu-container">
            <h2 class="menu-logo">MENU CONFIG</h2>
            
            <div class="menu-section">
                 <button id="btn-toggle-ui-mode" class="btn-menu-toggle">UI MODE: ANALOG</button>
                 <button id="btn-toggle-visualizer" class="btn-menu-toggle">VISUALIZER: OFF</button>
            </div>

            <div class="menu-section">
                <h3 class="section-label">BASS SYNTHS</h3>
                <div id="synth-list-container" class="list-vertical"></div>
                <button id="btn-add-synth" class="btn-dashed">+ ADD BASS</button>
            </div>

            <div class="menu-section">
                <h3 class="section-label">DRUM CONFIGURATION</h3>
                <div class="drum-config-header">
                    <span>CH</span><span>VARIANT</span><span>COLOR</span>
                </div>
                <div id="drum-config-container" class="drum-config-grid custom-scroll"></div>
            </div>

            <div class="menu-section vertical-stack">
                <button id="btn-open-memory" class="btn-menu-action text-purple">VIRTUAL MEMORY</button>
                <button id="btn-open-export" class="btn-menu-action text-green">EXPORT WAV</button>
                <button id="btn-toggle-log-menu" class="btn-menu-action">SHOW LOGS</button>
                <button id="btn-menu-clear" class="btn-menu-action text-red-dim">CLEAR PATTERN</button>
                <button id="btn-menu-panic" class="btn-menu-action text-red bg-red-dim">RESET SYSTEM</button>
            </div>
            
            <button id="btn-menu-close" class="btn-resume">RESUME</button>
        </div>
    </div>

    <!-- APP HEADER -->
    <header class="top-bar">
        <div class="brand-group" id="app-logo">
            <div id="activity-led" class="led-status"></div>
            <span class="brand-name">NEURODARK23</span>
        </div>
        <button id="btn-open-menu" class="btn-icon-menu">&#9776;</button>
    </header>

    <!-- WORKSPACE -->
    <div class="workspace-area custom-scroll">
        <div class="main-layout">
            
            <!-- DASHBOARD -->
            <div class="dashboard-card">
                <div class="dash-slot">
                    <label class="label-mini">BPM</label>
                    <input type="number" id="bpm-input" value="174" class="input-bpm">
                </div>

                <!-- TRANSPORT CENTER -->
                <div id="play-container" class="transport-center">
                    <svg id="play-clock-svg" class="clock-ring" viewBox="0 0 100 100"></svg>
                    <button id="btn-play" class="btn-transport-play">&#9658;</button>
                </div>

                <div class="dash-slot">
                    <label class="label-mini">BLOCK</label>
                    <div class="block-counter">
                        <span id="display-current-block" class="text-green">1</span> <span class="text-dim">/</span> <span id="display-total-blocks">1</span>
                    </div>
                </div>
            </div>

            <!-- CHAIN & TRACKS -->
            <div class="chain-section">
                <div class="chain-header">
                    <span class="label-mini">CHAIN</span>
                    <div class="chain-tools">
                        <button id="btn-mem-copy" class="btn-tool btn-cyan" title="Copy">CPY</button>
                        <button id="btn-mem-paste" class="btn-tool btn-cyan" title="Paste">PST</button>
                        <div class="sep-v"></div>
                        <button id="btn-move-left" class="btn-tool" title="Left">&larr;</button>
                        <button id="btn-move-right" class="btn-tool" title="Right">&rarr;</button>
                        <div class="sep-v"></div>
                        <button id="btn-add-block" class="btn-tool text-green">+</button>
                        <button id="btn-del-block" class="btn-tool text-red">&times;</button>
                    </div>
                </div>
                <div id="track-bar" class="track-timeline custom-scroll"></div>
            </div>

            <!-- INSTRUMENT TABS -->
            <div id="instrument-tabs-container" class="tabs-bar"></div>

            <!-- STEP MATRIX -->
            <div id="matrix-container" class="step-grid"></div>
            
            <div class="spacer-bottom"></div> 
        </div>
    </div>

    <!-- EDITOR PANEL (DRAWER) -->
    <div id="editor-panel" class="editor-drawer expanded">
        
        <div class="drawer-header" id="panel-header-trigger">
            <span id="step-info-display" class="drawer-title">EDIT MODE</span>
            
            <!-- DRAWER ACTIONS -->
            <div class="drawer-actions" onclick="event.stopPropagation()">
                
                <!-- BASS SPECIFIC TOOLS (Grouped for visibility toggling) -->
                <div id="bass-tools-group" class="tools-group">
                    <button id="btn-waveform" class="btn-pill">
                        <span class="wave-symbol">~</span> SAW
                    </button>
                    <div class="sep-v-dark"></div>
                </div>

                <!-- GLOBAL VIEW TOOLS -->
                <div class="view-toggles">
                    <button id="btn-toggle-view-keys" class="btn-pill active">KEYS</button>
                    <button id="btn-toggle-view-fx" class="btn-pill active">FX</button>
                </div>
                
                <div class="sep-v-dark"></div>
                <button id="btn-minimize-panel" class="btn-minimize">&#9660;</button>
            </div>
        </div>

        <div class="drawer-body">
            
            <!-- BASS EDITOR -->
            <div id="editor-bass" class="editor-content-bass custom-scroll">
                
                <!-- FX RACK -->
                <div id="subpanel-fx" class="control-group">
                    <div id="fx-container-bar" class="fx-rack">
                        
                        <!-- Analog Controls -->
                        <div id="fx-controls-analog" class="rack-grid">
                            <div class="rack-module span-2">
                                <label class="mod-label text-green">VOL</label>
                                <input type="range" id="vol-slider" min="0" max="100" value="85" class="fader">
                            </div>
                            <div class="rack-module"><label class="mod-label">CUT</label><input type="range" id="cutoff-slider" min="100" max="5000" value="800" class="fader"></div>
                            <div class="rack-module"><label class="mod-label">RES</label><input type="range" id="res-slider" min="0" max="20" value="4" class="fader"></div>
                            <div class="rack-module"><label class="mod-label">ENV</label><input type="range" id="env-slider" min="0" max="100" value="60" class="fader"></div>
                            <div class="rack-module"><label class="mod-label">DEC</label><input type="range" id="dec-slider" min="0" max="100" value="40" class="fader"></div>
                            <div class="rack-module"><label class="mod-label">ACC</label><input type="range" id="acc-slider" min="0" max="100" value="50" class="fader"></div>
                            <div class="rack-module"><label class="mod-label">DRV</label><input type="range" id="dist-slider" min="0" max="100" value="20" class="fader"></div>
                            <div class="rack-module"><label class="mod-label">TONE</label><input type="range" id="tone-slider" min="0" max="100" value="100" class="fader"></div>
                            <div class="rack-module"><label class="mod-label">GAIN</label><input type="range" id="dgain-slider" min="0" max="100" value="60" class="fader"></div>
                        </div>

                        <!-- Digital Controls -->
                        <div id="fx-controls-digital" class="digital-rack hidden">
                            <div class="digi-module"><div class="digi-label text-green">VOL</div><div class="digi-screen"><input type="number" id="vol-digital" class="digi-val"></div><div class="digi-btns"><button class="dfx-btn" data-target="volume" data-dir="-1">-</button><button class="dfx-btn" data-target="volume" data-dir="1">+</button></div></div>
                            <div class="digi-module"><div class="digi-label">CUT</div><div class="digi-screen"><input type="number" id="cutoff-digital" class="digi-val"></div><div class="digi-btns"><button class="dfx-btn" data-target="cutoff" data-dir="-1">-</button><button class="dfx-btn" data-target="cutoff" data-dir="1">+</button></div></div>
                            <div class="digi-module"><div class="digi-label">RES</div><div class="digi-screen"><input type="number" id="res-digital" class="digi-val"></div><div class="digi-btns"><button class="dfx-btn" data-target="resonance" data-dir="-1">-</button><button class="dfx-btn" data-target="resonance" data-dir="1">+</button></div></div>
                            <div class="digi-module"><div class="digi-label">ENV</div><div class="digi-screen"><input type="number" id="env-digital" class="digi-val"></div><div class="digi-btns"><button class="dfx-btn" data-target="envMod" data-dir="-1">-</button><button class="dfx-btn" data-target="envMod" data-dir="1">+</button></div></div>
                            <div class="digi-module"><div class="digi-label">DEC</div><div class="digi-screen"><input type="number" id="dec-digital" class="digi-val"></div><div class="digi-btns"><button class="dfx-btn" data-target="decay" data-dir="-1">-</button><button class="dfx-btn" data-target="decay" data-dir="1">+</button></div></div>
                            <div class="digi-module"><div class="digi-label">ACC</div><div class="digi-screen"><input type="number" id="acc-digital" class="digi-val"></div><div class="digi-btns"><button class="dfx-btn" data-target="accentInt" data-dir="-1">-</button><button class="dfx-btn" data-target="accentInt" data-dir="1">+</button></div></div>
                            <div class="digi-module"><div class="digi-label">DRV</div><div class="digi-screen"><input type="number" id="dist-digital" class="digi-val"></div><div class="digi-btns"><button class="dfx-btn" data-target="distortion" data-dir="-1">-</button><button class="dfx-btn" data-target="distortion" data-dir="1">+</button></div></div>
                            <div class="digi-module"><div class="digi-label">TONE</div><div class="digi-screen"><input type="number" id="tone-digital" class="digi-val"></div><div class="digi-btns"><button class="dfx-btn" data-target="distTone" data-dir="-1">-</button><button class="dfx-btn" data-target="distTone" data-dir="1">+</button></div></div>
                            <div class="digi-module"><div class="digi-label">GAIN</div><div class="digi-screen"><input type="number" id="dgain-digital" class="digi-val"></div><div class="digi-btns"><button class="dfx-btn" data-target="distGain" data-dir="-1">-</button><button class="dfx-btn" data-target="distGain" data-dir="1">+</button></div></div>
                        </div>
                    </div>
                </div>

                <!-- KEYBOARD & MODS -->
                <div id="subpanel-keys" class="control-group">
                    <div class="keyboard-bar">
                        <div class="octave-widget">
                            <button id="oct-down" class="btn-oct">-</button>
                            <span id="oct-display" class="oct-val text-green">3</span>
                            <button id="oct-up" class="btn-oct">+</button>
                        </div>
                        
                        <div class="note-mods">
                            <button id="btn-toggle-slide" class="btn-mod">~ SLIDE</button>
                            <button id="btn-toggle-accent" class="btn-mod">^ ACCENT</button>
                        </div>

                    </div>

                    <div id="piano-container" class="piano-bed">
                        <div class="keys-white">
                            <button class="key-w" data-note="C">C</button>
                            <button class="key-w" data-note="D">D</button>
                            <button class="key-w" data-note="E">E</button>
                            <button class="key-w" data-note="F">F</button>
                            <button class="key-w" data-note="G">G</button>
                            <button class="key-w" data-note="A">A</button>
                            <button class="key-w" data-note="B">B</button>
                        </div>
                        <button class="key-b pos-1" data-note="C#">C#</button>
                        <button class="key-b pos-2" data-note="D#">D#</button>
                        <button class="key-b pos-3" data-note="F#">F#</button>
                        <button class="key-b pos-4" data-note="G#">G#</button>
                        <button class="key-b pos-5" data-note="A#">A#</button>
                    </div>
                    
                    <button id="btn-delete-note" class="btn-delete-note">CLEAR NOTE</button>
                </div>
            </div>

            <!-- DRUM EDITOR -->
            <div id="editor-drum" class="editor-content-drum hidden custom-scroll"></div>
        </div>
    </div>

    <script src="Synth/fx_synth.js"></script>
    <script src="Synth/bass_synth.js"></script>
    <script src="Synth/drum_synth.js"></script>
    <script src="Synth/timematrix.js"></script>
    <script src="Synth/audio_engine.js"></script>
    <script src="Synth/ui_controller.js"></script>
    <script src="main.js"></script>
</body>
</html>