<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NEURODARK 23 // v39</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <!-- SYSTEM LOGS (Hidden by default) -->
    <div id="sys-log-panel" class="log-terminal">
        <div class="terminal-header">
            <span class="terminal-title">:: SYSTEM_DEBUG ::</span>
            <div>
                <button class="btn-term" onclick="document.getElementById('sys-log-content').innerHTML=''">CLEAR</button>
                <button class="btn-term" id="btn-toggle-log-internal">[ HIDE ]</button>
            </div>
        </div>
        <div id="sys-log-content" class="terminal-body custom-scroll"></div>
    </div>

    <!-- TOP HEADER -->
    <header class="top-bar">
        <div class="brand-group" id="app-logo">
            <div id="activity-led" class="led-status"></div>
            <div class="brand-name glitch-text">NEURODARK<span class="text-green">23</span></div>
        </div>
        <div class="header-controls">
            <button id="btn-open-menu" class="btn-icon-menu">&#9776;</button>
        </div>
    </header>

    <!-- MAIN WORKSPACE -->
    <div class="workspace-area custom-scroll">
        <div class="main-layout">
            
            <!-- DASHBOARD: BPM & TRANSPORT -->
            <div class="dashboard-card">
                <div class="dash-slot">
                    <span class="label-mini">BPM</span>
                    <input type="number" id="bpm-input" class="input-bpm" value="174">
                </div>

                <!-- TRANSPORT CENTER (Play/Pause + Clock) -->
                <div class="transport-center">
                    <!-- SVG Clock Ring -->
                    <svg id="play-clock-svg" class="clock-ring" viewBox="0 0 100 100"></svg>
                    <!-- Play Button Centered -->
                    <button id="btn-play" class="btn-transport-play">&#9658;</button>
                </div>

                <div class="dash-slot">
                    <span class="label-mini">BLOCK</span>
                    <div class="block-counter">
                        <span id="display-current-block" class="text-green">1</span> / <span id="display-total-blocks">1</span>
                    </div>
                </div>
            </div>

            <!-- CHAIN & TRACKS -->
            <div class="chain-section">
                <div class="chain-header">
                    <span class="label-mini">CHAIN</span>
                    <div class="chain-tools">
                        <button id="btn-mem-copy" class="btn-tool">CPY</button>
                        <button id="btn-mem-paste" class="btn-tool">PST</button>
                        <div class="sep-v"></div>
                        <button id="btn-move-left" class="btn-tool">&larr;</button>
                        <button id="btn-move-right" class="btn-tool">&rarr;</button>
                        <div class="sep-v"></div>
                        <button id="btn-add-block" class="btn-tool">+</button>
                        <button id="btn-del-block" class="btn-tool text-red">&times;</button>
                    </div>
                </div>
                <div id="track-bar" class="track-timeline custom-scroll">
                    <!-- Javascript renders blocks here -->
                </div>
            </div>

            <!-- TABS & MATRIX -->
            <div class="matrix-section">
                <div id="instrument-tabs-container" class="tabs-bar">
                    <!-- Tabs generated by JS -->
                </div>
                
                <div class="matrix-header-info">
                    <span id="step-info-display" class="label-mini text-green" style="margin-left: 4px;">STEP 1 // BASS-1</span>
                </div>

                <div id="matrix-container" class="step-grid">
                    <!-- Grid generated by JS -->
                </div>
            </div>

            <div class="spacer-bottom"></div>
        </div>
    </div>

    <!-- EDITOR DRAWER -->
    <div id="editor-panel" class="editor-drawer expanded">
        <div class="drawer-header" id="panel-header-trigger">
            <span class="drawer-title">EDITOR</span>
            <div class="drawer-actions">
                <button id="btn-minimize-panel" class="btn-minimize">&#9660;</button>
            </div>
        </div>

        <div class="drawer-body">
            
            <!-- BASS EDITOR -->
            <div id="editor-bass" class="editor-content-bass">
                
                <!-- NEW: BASS TOOLBAR (Waveform, Keys, FX) -->
                <div class="bass-toolbar">
                    <button id="btn-waveform" class="btn-tool-toggle">~ SAW</button>
                    <button id="btn-toggle-view-keys" class="btn-tool-toggle active">KEYS</button>
                    <button id="btn-toggle-view-fx" class="btn-tool-toggle active">FX</button>
                </div>

                <!-- FX CONTROLS (ANALOG STYLE) -->
                <div id="fx-controls-analog" class="control-group" id="subpanel-fx">
                    <div class="rack-grid">
                        <div class="rack-module span-2">
                            <span class="mod-label">VOL</span>
                            <input type="range" id="vol-slider" class="fader" min="0" max="100">
                        </div>
                        <div class="rack-module">
                            <span class="mod-label">CUT</span>
                            <input type="range" id="cutoff-slider" class="fader" min="0" max="100">
                        </div>
                        <div class="rack-module">
                            <span class="mod-label">RES</span>
                            <input type="range" id="res-slider" class="fader" min="0" max="100">
                        </div>
                        <div class="rack-module">
                            <span class="mod-label">ENV</span>
                            <input type="range" id="env-slider" class="fader" min="0" max="100">
                        </div>
                        <div class="rack-module">
                            <span class="mod-label">DEC</span>
                            <input type="range" id="dec-slider" class="fader" min="0" max="100">
                        </div>
                        <div class="rack-module">
                            <span class="mod-label">ACC</span>
                            <input type="range" id="acc-slider" class="fader" min="0" max="100">
                        </div>
                        <div class="rack-module">
                            <span class="mod-label">DRV</span>
                            <input type="range" id="dist-slider" class="fader" min="0" max="100">
                        </div>
                        <div class="rack-module">
                            <span class="mod-label">TONE</span>
                            <input type="range" id="tone-slider" class="fader" min="0" max="100">
                        </div>
                        <div class="rack-module">
                            <span class="mod-label">GAIN</span>
                            <input type="range" id="dgain-slider" class="fader" min="0" max="100">
                        </div>
                    </div>
                </div>

                <!-- FX CONTROLS (DIGITAL STYLE - Hidden by default) -->
                <div id="fx-controls-digital" class="control-group hidden">
                    <div class="digital-rack">
                        <!-- Helper function in JS populates this or we hardcode structure here -->
                        <!-- For simplicity, keeping the structure hardcoded to match bind logic -->
                        <div class="digi-module"><div class="digi-label">VOL</div><div class="digi-screen"><div id="vol-digital" class="digi-val">85</div></div><div class="digi-btns"><button class="dfx-btn" data-target="volume" data-dir="-1">-</button><button class="dfx-btn" data-target="volume" data-dir="1">+</button></div></div>
                        <div class="digi-module"><div class="digi-label">CUT</div><div class="digi-screen"><div id="cutoff-digital" class="digi-val">40</div></div><div class="digi-btns"><button class="dfx-btn" data-target="cutoff" data-dir="-1">-</button><button class="dfx-btn" data-target="cutoff" data-dir="1">+</button></div></div>
                        <div class="digi-module"><div class="digi-label">RES</div><div class="digi-screen"><div id="res-digital" class="digi-val">40</div></div><div class="digi-btns"><button class="dfx-btn" data-target="resonance" data-dir="-1">-</button><button class="dfx-btn" data-target="resonance" data-dir="1">+</button></div></div>
                        <div class="digi-module"><div class="digi-label">ENV</div><div class="digi-screen"><div id="env-digital" class="digi-val">60</div></div><div class="digi-btns"><button class="dfx-btn" data-target="envMod" data-dir="-1">-</button><button class="dfx-btn" data-target="envMod" data-dir="1">+</button></div></div>
                        <div class="digi-module"><div class="digi-label">DEC</div><div class="digi-screen"><div id="dec-digital" class="digi-val">40</div></div><div class="digi-btns"><button class="dfx-btn" data-target="decay" data-dir="-1">-</button><button class="dfx-btn" data-target="decay" data-dir="1">+</button></div></div>
                        <div class="digi-module"><div class="digi-label">ACC</div><div class="digi-screen"><div id="acc-digital" class="digi-val">50</div></div><div class="digi-btns"><button class="dfx-btn" data-target="accentInt" data-dir="-1">-</button><button class="dfx-btn" data-target="accentInt" data-dir="1">+</button></div></div>
                        <div class="digi-module"><div class="digi-label">DRV</div><div class="digi-screen"><div id="dist-digital" class="digi-val">20</div></div><div class="digi-btns"><button class="dfx-btn" data-target="distortion" data-dir="-1">-</button><button class="dfx-btn" data-target="distortion" data-dir="1">+</button></div></div>
                        <div class="digi-module"><div class="digi-label">TONE</div><div class="digi-screen"><div id="tone-digital" class="digi-val">100</div></div><div class="digi-btns"><button class="dfx-btn" data-target="distTone" data-dir="-1">-</button><button class="dfx-btn" data-target="distTone" data-dir="1">+</button></div></div>
                        <div class="digi-module"><div class="digi-label">GAIN</div><div class="digi-screen"><div id="dgain-digital" class="digi-val">60</div></div><div class="digi-btns"><button class="dfx-btn" data-target="distGain" data-dir="-1">-</button><button class="dfx-btn" data-target="distGain" data-dir="1">+</button></div></div>
                    </div>
                </div>

                <!-- KEYBOARD AREA -->
                <div id="subpanel-keys" class="control-group" style="margin-top: 8px;">
                    <div class="keyboard-bar">
                        <div class="note-mods">
                            <button id="btn-toggle-slide" class="btn-mod">~ SLIDE</button>
                            <button id="btn-toggle-accent" class="btn-mod">^ ACCENT</button>
                        </div>
                        <div class="octave-widget">
                            <button id="oct-down" class="btn-oct">-</button>
                            <div id="oct-display" class="oct-val">3</div>
                            <button id="oct-up" class="btn-oct">+</button>
                        </div>
                    </div>
                    
                    <div class="piano-bed">
                        <div class="key-b pos-1" data-note="C#">C#</div>
                        <div class="key-b pos-2" data-note="D#">D#</div>
                        <div class="key-b pos-3" data-note="F#">F#</div>
                        <div class="key-b pos-4" data-note="G#">G#</div>
                        <div class="key-b pos-5" data-note="A#">A#</div>
                        <div class="keys-white">
                            <div class="key-w" data-note="C">C</div>
                            <div class="key-w" data-note="D">D</div>
                            <div class="key-w" data-note="E">E</div>
                            <div class="key-w" data-note="F">F</div>
                            <div class="key-w" data-note="G">G</div>
                            <div class="key-w" data-note="A">A</div>
                            <div class="key-w" data-note="B">B</div>
                        </div>
                    </div>
                    <button id="btn-delete-note" class="btn-delete-note">CLEAR NOTE</button>
                </div>

                <div id="subpanel-fx" class="hidden"></div> <!-- Placeholder if logic toggles separate panel -->
            </div>

            <!-- DRUM EDITOR -->
            <div id="editor-drum" class="editor-content-drum hidden">
                <!-- JS Generated -->
            </div>

        </div>
    </div>

    <!-- MAIN MENU MODAL -->
    <div id="main-menu" class="modal-overlay hidden">
        <div class="menu-container custom-scroll">
            <div class="modal-header">NEURODARK SYSTEM</div>
            
            <div class="menu-section">
                <span class="section-label">SYNTHS</span>
                <button id="btn-add-synth" class="btn-menu-action text-green">+ ADD BASS SYNTH</button>
                <div id="synth-list-container" class="list-vertical"></div>
            </div>

            <div class="menu-section">
                <!-- DRUM CONFIGURATION CONTAINER (JS Generated) -->
                <div id="drum-config-container"></div>
            </div>

            <div class="menu-section">
                <span class="section-label">PROJECT</span>
                <div class="grid-2">
                    <button id="btn-menu-clear" class="btn-option text-red">CLEAR ALL</button>
                    <button id="btn-menu-panic" class="btn-option text-red">PANIC</button>
                </div>
                <button id="btn-open-export" class="btn-menu-action">EXPORT AUDIO / PROJECT</button>
                <button id="btn-open-memory" class="btn-menu-action">MEMORY / CSV</button>
            </div>

            <div class="menu-section">
                <span class="section-label">INTERFACE</span>
                <button id="btn-toggle-ui-mode" class="btn-menu-toggle">UI MODE: ANALOG</button>
                <button id="btn-toggle-visualizer" class="btn-menu-toggle">VISUALIZER: OFF</button>
                <button id="btn-toggle-log-menu" class="btn-menu-toggle">SYSTEM LOGS</button>
            </div>

            <button id="btn-menu-close" class="btn-resume">RESUME</button>
        </div>
    </div>

    <!-- EXPORT MODAL -->
    <div id="export-modal" class="modal-overlay hidden">
        <div class="modal-window">
            <div class="modal-header">EXPORT AUDIO</div>
            <span class="label-tech">RENDER LENGTH (LOOPS)</span>
            <div class="grid-4 gap-md">
                <button class="btn-option active" data-rep="1">1</button>
                <button class="btn-option" data-rep="2">2</button>
                <button class="btn-option" data-rep="4">4</button>
                <button class="btn-option" data-rep="8">8</button>
            </div>
            <button id="btn-start-render" class="btn-primary btn-green-solid">RENDER WAV</button>
            <button id="btn-close-export" class="btn-text">CANCEL</button>
        </div>
    </div>

    <!-- MEMORY MODAL -->
    <div id="memory-modal" class="modal-overlay hidden">
        <div class="modal-window modal-wide">
            <div class="modal-header">MEMORY BANK (CSV)</div>
            <textarea id="csv-io-area" class="input-area custom-scroll" placeholder="paste csv data here..."></textarea>
            <div class="grid-2 gap-md">
                <button id="btn-gen-csv" class="btn-secondary">GENERATE CSV</button>
                <button id="btn-load-csv" class="btn-secondary text-green">LOAD CSV</button>
            </div>
            
            <div class="file-io-bar">
                <button id="btn-download-csv" class="link-btn">SAVE TO FILE</button>
                <label for="file-upload-csv" class="link-btn">LOAD FROM FILE</label>
                <input type="file" id="file-upload-csv" accept=".csv" class="hidden">
            </div>

            <button id="btn-close-memory" class="btn-block-dark">CLOSE</button>
        </div>
    </div>

    <!-- CORE SCRIPTS -->
    <script>
        // Simple on-screen logger
        window.logToScreen = function(msg, type='info') {
            const el = document.getElementById('sys-log-content');
            if(!el) return;
            const row = document.createElement('div');
            const time = new Date().toLocaleTimeString();
            row.innerHTML = `<span style="opacity:0.5">[${time}]</span> ${msg}`;
            if(type === 'error') row.classList.add('log-err');
            el.appendChild(row);
            el.scrollTop = el.scrollHeight;
        };
    </script>
    <script src="fx_synth.js"></script>
    <script src="drum_synth.js"></script>
    <script src="bass_synth.js"></script>
    <script src="timematrix.js"></script>
    <script src="audio_engine.js"></script>
    <script src="ui_controller.js"></script>
    <script src="main.js"></script>
</body>
</html>